## Тестирование!

### 7 семестр ИУ7

Вообще мой любимый предмет 7 семестра, но скорее потому что тут было много девопсерских приколов. В какой-то момент у меня был тройной dind, ибо я не хотела делать shell-раннер, но к 4 лабе пришлось.

Я брала проект с курса по ППО 5 семестра.
На каждую отедльная ветка, лучше так и сдавать. Только у меня вроде был какой-то прикол с ветками для первых двух лаб, а точнее из-за одного теста, но это не точно. Я сдавала все одной из первой, а вы сами знаете, что это максимальная лояльность + много времени уходило на обсуждения dind.


##### Команды для запуска всех тестов можно найти в [.gitlab-ci.yml](https://github.com/Dashori/bmstu-testing/blob/main/.gitlab-ci.yml).

#### Лабораторные работы
1. Unit тесты в internal/services. Там было условие про классический и Лондонский вариант. У меня все было сделано еще на курсе, кроме классического теста. Его я делала в моменте и сейчас я его нахожу только в [коммите](https://github.com/Dashori/bmstu-testing/commit/add3e6abb2231b2c384a9ba72ec1470074004523#diff-670949da573334494a923566f54ce892c39fd4ed04f885bcae07c509bffdf14aR231). И кажется он еще нормально не работает аххаха... С allure там тоже какая-то самодельная история от ребят с потока. В [.gitlab-ci.yml](https://github.com/Dashori/bmstu-testing/blob/main/.gitlab-ci.yml) все команды для запуска.

2. Интеграционные тесты были написаны на курсе ранее и там вроде без проблем все internal/repository Под E2E тесты отдельная папочка, собственно нужно поднять все из docker-compose.yml и потом запустить этот тест. Вероятно для локального запуска нужно будет сделать пару приседаний в конфиге (вероятно поменять адрес на localhost). Для захвата трафика я вроде просто сделала tcpdump и открыла его в Wireshark.

3. Тут вроде все норм, есть отдельный [docker-compose-bemch.yml](https://github.com/Dashori/bmstu-testing/blob/main/docker-compose-bench.yaml) со сбором метрик с помощью Prometheus и отрисовкой в Grafana. Я еще нашла отдельный докерфайл для этого, не помню как в итоге сдавала, но думаю там несложно будет разобраться.

4. Моя любимая лаба! У меня была 2FA с помощью почты, личный почтовый сервак Вовы, спасибо ему. Создал мне две кринжовые почты dashylya@huds.su и dashori@huds.su, одна так сказать системная и с нее я отправляла коды, а другая пользовательская для теста. Логика теста следующая: отправляем запрос с почтой => на эту почту высылается OTP код (но на самом деле это просто [хэш](https://github.com/Dashori/bmstu-testing/blob/main/backend/internal/services/implementation/client.go#L86) от этой же почты) => читаем это письмо и берем из него OTP => повторяем запрос с этим OTP. Для хранения пароля от почт я использовала [Vault](https://www.vaultproject.io/), я поднимала его локально в докер-контейнере и так как shell-раннер был на этом же ноуте, то он мог получить до него доступ. Настройка есть в [папочке](https://github.com/Dashori/bmstu-testing/tree/main/vault). Перед началом теста я просто клала пароли из волта в [переменные окружения](https://github.com/Dashori/bmstu-testing/blob/main/.gitlab-ci.yml#L67) и дальше в коде их оттуда и [получала](https://github.com/Dashori/bmstu-testing/blob/lab_04/e2e/client_controller/client_otp_test.go#L37).


5. Я сдавала ее вместе с 4 лабой, так что ее у меня сильно не смотрели. Я использовала jaeger, точно помню, что у меня не было красивых вложенных трейсингов и все спаны были 1 уровня. Но из прикольного я забирала инфу для визуализации [курлом](https://github.com/Dashori/bmstu-testing/blob/lab_05/.gitlab-ci.yml#L53) и клала в артефакты.